import{c as V,x as te,u as se,r as u,t as D,E as H,j as e,C as f,e as N,y as v,f as b,T as ae,p as ne,q as B,s as G,B as R,A as z,h as Y,d as ie}from"./index-CadMXyJB.js";import{S as $,g as ce,a as re,d as P}from"./marked.esm-BChSSRKN.js";import{T as W}from"./trending-down-7vN5W4-d.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],le=V("lightbulb",oe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],q=V("refresh-cw",de);function ue(){const{user:l}=te(),{toast:h}=se(),[C,F]=u.useState(""),[J,k]=u.useState(""),[M,O]=u.useState(""),[K,E]=u.useState(""),[A,S]=u.useState(!1),[w,T]=u.useState(!1),[g,Q]=u.useState({totalIncome:0,totalExpenses:0,budgetedExpenses:0,savingsRate:0,budgetAdherence:0});u.useEffect(()=>{l&&U()},[l]);const U=async()=>{if(!l)return;const i=new Date,c=i.getMonth()+1,r=i.getFullYear(),n=i.toISOString().slice(0,7),m=await D.getTransactions(l.id),_=await H.getBudgets(l.id),o=m.filter(t=>t.transaction_date.startsWith(n)),a=o.filter(t=>t.transaction_type==="income").reduce((t,s)=>t+s.amount,0),x=o.filter(t=>t.transaction_type==="expense"||t.transaction_type==="loan_payment").reduce((t,s)=>t+s.amount,0),p=_.find(t=>t.month===c&&t.year===r),d=(p==null?void 0:p.budgeted_expenses)||0,y=a>0?(a-x)/a*100:0,j=d>0?x/d*100:0;Q({totalIncome:a,totalExpenses:x,budgetedExpenses:d,savingsRate:y,budgetAdherence:j})},L=async()=>{if(!l)return{totalIncome:0,totalExpenses:0,budgetedExpenses:0,transactions:[],accountBalances:[]};const i=new Date,c=i.getMonth()+1,r=i.getFullYear(),n=i.toISOString().slice(0,7),m=await D.getTransactions(l.id),_=await ie.getAccounts(l.id),o=await H.getBudgets(l.id),a=m.filter(s=>s.transaction_date.startsWith(n)),x=a.filter(s=>s.transaction_type==="income").reduce((s,I)=>s+I.amount,0),p=a.filter(s=>s.transaction_type==="expense"||s.transaction_type==="loan_payment").reduce((s,I)=>s+I.amount,0),d=o.find(s=>s.month===c&&s.year===r),y=(d==null?void 0:d.budgeted_expenses)||0,j=_.map(s=>({name:s.account_name,balance:s.balance,type:s.account_type})),t=X(m,c,r);return{totalIncome:x,totalExpenses:p,budgetedExpenses:y,transactions:a.map(s=>({type:s.transaction_type,category:s.transaction_type==="income"?s.income_category||"others":s.category||"uncategorized",amount:s.amount,date:s.transaction_date,description:s.description})),accountBalances:j,historicalData:t}},X=(i,c,r)=>{const n=[],m={};for(let o=1;o<=3;o++){let a=c-o,x=r;a<=0&&(a+=12,x-=1);const p=`${x}-${String(a).padStart(2,"0")}`,d=i.filter(t=>t.transaction_date.startsWith(p)),y=d.filter(t=>t.transaction_type==="income").reduce((t,s)=>t+s.amount,0),j=d.filter(t=>t.transaction_type==="expense"||t.transaction_type==="loan_payment").reduce((t,s)=>t+s.amount,0);n.unshift({month:p,income:y,expenses:j,savings:y-j}),d.filter(t=>t.transaction_type==="expense").forEach(t=>{m[t.category]||(m[t.category]=[]),m[t.category].push(t.amount)})}return{monthlyAverages:{income:n.reduce((o,a)=>o+a.income,0)/n.length,expenses:n.reduce((o,a)=>o+a.expenses,0)/n.length,savings:n.reduce((o,a)=>o+a.savings,0)/n.length},categoryTrends:m,lastThreeMonths:n}},Z=async()=>{const i=await L();if(i.transactions.length===0){h({title:"No Data Available",description:"Please add some transactions first to get AI analysis.",variant:"destructive"});return}S(!0),F(""),k("");let c="";await ce(i,r=>{c+=r,F(c);const n=P.parse(c);k(n)},()=>{S(!1),h({title:"Analysis Complete",description:"Your financial analysis has been generated."})},r=>{S(!1),h({title:"Analysis Failed",description:r,variant:"destructive"})})},ee=async()=>{const i=await L();if(i.transactions.length===0){h({title:"No Data Available",description:"Please add some transactions first to get budget optimization.",variant:"destructive"});return}T(!0),O(""),E("");let c="";await re(i,r=>{c+=r,O(c);const n=P.parse(c);E(n)},()=>{T(!1),h({title:"Optimization Complete",description:"Your budget optimization has been generated."})},r=>{T(!1),h({title:"Optimization Failed",description:r,variant:"destructive"})})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"h-8 w-8 text-primary"}),"AI Financial Analysis"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Get AI-powered insights and recommendations for your finances"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(f,{children:e.jsxs(N,{className:"pb-3",children:[e.jsx(v,{children:"Total Income"}),e.jsxs(b,{className:"text-2xl text-green-600",children:["₹",g.totalIncome.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})}),e.jsx(f,{children:e.jsxs(N,{className:"pb-3",children:[e.jsx(v,{children:"Total Expenses"}),e.jsxs(b,{className:"text-2xl text-red-600",children:["₹",g.totalExpenses.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})}),e.jsx(f,{children:e.jsxs(N,{className:"pb-3",children:[e.jsx(v,{children:"Savings Rate"}),e.jsxs(b,{className:"text-2xl text-primary",children:[g.savingsRate.toFixed(1),"%"]})]})}),e.jsx(f,{children:e.jsxs(N,{className:"pb-3",children:[e.jsx(v,{children:"Budget Adherence"}),e.jsx(b,{className:`text-2xl ${g.budgetAdherence>100?"text-red-600":"text-green-600"}`,children:g.budgetAdherence>0?`${g.budgetAdherence.toFixed(1)}%`:"N/A"})]})})]}),e.jsxs(ae,{defaultValue:"analysis",className:"space-y-4",children:[e.jsxs(ne,{className:"grid w-full grid-cols-2",children:[e.jsxs(B,{value:"analysis",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Financial Analysis"]}),e.jsxs(B,{value:"optimization",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Budget Optimization"]})]}),e.jsx(G,{value:"analysis",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Comprehensive Financial Analysis"}),e.jsx(v,{children:"AI-powered insights into your spending patterns, budget adherence, and financial health"})]}),e.jsx(R,{onClick:Z,disabled:A||!l,children:A?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Generate Analysis"]})})]})}),e.jsxs(Y,{children:[A&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(z,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analyzing your financial data..."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This may take up to 30 seconds"})]}),!A&&!C&&e.jsxs("div",{className:"text-center py-12 space-y-4",children:[e.jsx($,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:'Click "Generate Analysis" to get AI-powered insights'})]}),!A&&C&&e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J}})})]})]})}),e.jsx(G,{value:"optimization",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Budget Optimization Recommendations"}),e.jsx(v,{children:"AI-generated suggestions to reduce expenses and optimize your budget"})]}),e.jsx(R,{onClick:ee,disabled:w||!l,children:w?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Optimizing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Generate Optimization"]})})]})}),e.jsxs(Y,{children:[w&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(z,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optimizing your budget..."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This may take up to 30 seconds"})]}),!w&&!M&&e.jsxs("div",{className:"text-center py-12 space-y-4",children:[e.jsx(W,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:'Click "Generate Optimization" to get budget recommendations'})]}),!w&&M&&e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:K}})})]})]})})]})]})}export{ue as default};
