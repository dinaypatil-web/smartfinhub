import{c as k,x as $,u as q,r as f,j as e,C as w,e as _,f as A,y as I,h as B,a8 as M,B as T,ao as j,d as g,t as y,E as N,i as E,l as F}from"./index-CadMXyJB.js";import{A as V,a as J,b as W,c as K,d as G,e as Q,f as X,g as Z}from"./alert-dialog-D5-RVg6R.js";import{D as P}from"./download-CITfR4fP.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],te=k("database",ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],se=k("file-braces",ae);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],re=k("triangle-alert",ce);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],L=k("upload",ie);function de(){var C,D;const{user:r}=$(),{toast:u}=q(),[b,p]=f.useState(!1),[O,v]=f.useState(!1),[s,R]=f.useState(null),x=f.useRef(null),U=async()=>{if(r){p(!0);try{const[i,m,h,n,a]=await Promise.all([g.getAccounts(r.id),y.getTransactions(r.id),N.getBudgets(r.id),E.getInterestRates(r.id),F.getLoanEMIPayments(r.id)]),o={version:"1.0",timestamp:new Date().toISOString(),userId:r.id,data:{accounts:i,transactions:m,budgets:h,interestRates:n,loanEMIPayments:a}},l=JSON.stringify(o,null,2),c=new Blob([l],{type:"application/json"}),d=URL.createObjectURL(c),t=document.createElement("a");t.href=d,t.download=`smartfinhub-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(d),u({title:"Backup Created Successfully",description:"Your data has been exported to a file. Store it securely."})}catch(i){console.error("Backup error:",i),u({title:"Backup Failed",description:"Failed to create backup. Please try again.",variant:"destructive"})}finally{p(!1)}}},H=i=>{var n;const m=(n=i.target.files)==null?void 0:n[0];if(!m||!r)return;const h=new FileReader;h.onload=a=>{var o;try{const l=(o=a.target)==null?void 0:o.result,c=JSON.parse(l);if(!c.version||!c.timestamp||!c.data)throw new Error("Invalid backup file format");if(!c.data.accounts||!c.data.transactions)throw new Error("Backup file is missing required data");if(c.userId&&c.userId!==r.id){u({title:"Unauthorized Backup File",description:"This backup file belongs to a different user. You can only restore your own backups.",variant:"destructive"});return}R(c),v(!0)}catch(l){console.error("File parse error:",l),u({title:"Invalid Backup File",description:"The selected file is not a valid SmartFinHub backup.",variant:"destructive"})}},h.readAsText(m)},Y=async()=>{if(!(!r||!s)){p(!0),v(!1);try{const i=await g.getAccounts(r.id),m=await y.getTransactions(r.id),h=await N.getBudgets(r.id);await Promise.all([...m.map(a=>y.deleteTransaction(a.id)),...i.map(a=>g.deleteAccount(a.id)),...h.map(a=>N.deleteBudget(a.id))]);const n=new Map;for(const a of s.data.accounts){const o=a.id,{id:l,user_id:c,created_at:d,updated_at:t,...z}=a,S=await g.createAccount(z);S&&n.set(o,S.id)}for(const a of s.data.transactions){const{id:o,user_id:l,created_at:c,updated_at:d,...t}=a;t.account_id&&(t.account_id=n.get(t.account_id)||t.account_id),t.from_account_id&&(t.from_account_id=n.get(t.from_account_id)||t.from_account_id),t.to_account_id&&(t.to_account_id=n.get(t.to_account_id)||t.to_account_id),await y.createTransaction(t)}for(const a of s.data.budgets){const{id:o,user_id:l,created_at:c,updated_at:d,...t}=a;await N.createOrUpdateBudget(t)}for(const a of s.data.interestRates||[]){const{id:o,user_id:l,created_at:c,updated_at:d,...t}=a;t.account_id&&(t.account_id=n.get(t.account_id)||t.account_id),await E.createInterestRate(t)}for(const a of s.data.loanEMIPayments||[]){const{id:o,user_id:l,created_at:c,updated_at:d,...t}=a;t.account_id&&(t.account_id=n.get(t.account_id)||t.account_id),await F.createLoanEMIPayment(t)}u({title:"Restore Completed Successfully",description:"Your data has been restored from the backup file."}),setTimeout(()=>{window.location.reload()},1500)}catch(i){console.error("Restore error:",i),u({title:"Restore Failed",description:"Failed to restore data. Your existing data remains unchanged.",variant:"destructive"})}finally{p(!1),R(null),x.current&&(x.current.value="")}}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Backup & Restore"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Export your financial data to a file or restore from a previous backup"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsx(A,{children:"Backup Data"})]}),e.jsx(I,{children:"Export all your accounts, transactions, and budgets to a file"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"What's included:"}),e.jsxs("ul",{className:"text-muted-foreground list-disc list-inside mt-1",children:[e.jsx("li",{children:"All accounts (Bank, Credit Card, Loan)"}),e.jsx("li",{children:"All transactions"}),e.jsx("li",{children:"Budget information"}),e.jsx("li",{children:"Interest rate history"}),e.jsx("li",{children:"Loan EMI payment records"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(M,{className:"h-4 w-4 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-600 dark:text-amber-500",children:"Security Notice:"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Backup files contain sensitive financial data. Store them securely and never share them with others."})]})]})]}),e.jsx(T,{onClick:U,disabled:b,className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Download Backup"]})})]})]}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-primary"}),e.jsx(A,{children:"Restore Data"})]}),e.jsx(I,{children:"Import data from a previously created backup file"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"How it works:"}),e.jsxs("ul",{className:"text-muted-foreground list-disc list-inside mt-1",children:[e.jsx("li",{children:"Select a backup file (.json)"}),e.jsx("li",{children:"Review the backup information"}),e.jsx("li",{children:"Confirm to restore your data"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(re,{className:"h-4 w-4 text-destructive mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Warning:"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Restoring will replace all your current data with the backup. This action cannot be undone."})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Security:"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"You can only restore backups that belong to your account. Backups from other users will be rejected."})]})]})]}),e.jsx("input",{ref:x,type:"file",accept:".json",onChange:H,className:"hidden",id:"backup-file-input"}),e.jsxs(T,{onClick:()=>{var i;return(i=x.current)==null?void 0:i.click()},disabled:b,variant:"outline",className:"w-full",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Select Backup File"]})]})]})]}),e.jsxs(w,{className:"mt-6",children:[e.jsx(_,{children:e.jsx(A,{className:"text-lg",children:"Best Practices"})}),e.jsx(B,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-emerald-600"}),"Regular Backups"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create backups regularly, especially before making major changes to your accounts or transactions."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-emerald-600"}),"Secure Storage"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Store backup files in a secure location like encrypted cloud storage or password-protected folders."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-emerald-600"}),"Multiple Copies"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Keep multiple backup copies in different locations to prevent data loss."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-emerald-600"}),"Test Restores"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Periodically test your backup files to ensure they can be restored successfully."})]})]})})]}),e.jsx(V,{open:O,onOpenChange:v,children:e.jsxs(J,{children:[e.jsxs(W,{children:[e.jsx(K,{children:"Confirm Data Restore"}),e.jsxs(G,{className:"space-y-3",children:[e.jsxs("p",{children:["You are about to restore data from a backup created on"," ",e.jsx("strong",{children:s?new Date(s.timestamp).toLocaleString():""}),"."]}),s&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium mb-2",children:"Backup contains:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• ",s.data.accounts.length," accounts"]}),e.jsxs("li",{children:["• ",s.data.transactions.length," transactions"]}),e.jsxs("li",{children:["• ",s.data.budgets.length," budgets"]}),((C=s.data.interestRates)==null?void 0:C.length)>0&&e.jsxs("li",{children:["• ",s.data.interestRates.length," interest rate records"]}),((D=s.data.loanEMIPayments)==null?void 0:D.length)>0&&e.jsxs("li",{children:["• ",s.data.loanEMIPayments.length," loan EMI payment records"]})]})]}),e.jsx("p",{className:"text-destructive font-medium",children:"⚠️ This will permanently delete all your current data and replace it with the backup. This action cannot be undone."})]})]}),e.jsxs(Q,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Z,{onClick:Y,className:"bg-destructive hover:bg-destructive/90",children:"Restore Data"})]})]})})]})}export{de as default};
