import{x as pe,u as ye,r as d,_ as M,E as R,j as e,C as _,e as w,f as B,h as S,T as fe,p as Ne,q as z,s as G,L as j,I as y,B as f,A as q,D as ve,m as be,n as Ce,o as _e,v as we,a1 as Be}from"./index-CadMXyJB.js";import{S as J,a as Q,b as W,c as X,d as Z}from"./select-BtuBbjBO.js";import{g as K,c as Se,f as c}from"./format-RllGV7dv.js";import{P as E}from"./progress-B0zBlC70.js";import{I as ee}from"./incomeCategories-h_Agwvah.js";import{P as Ee}from"./plus-nRr9gPfm.js";import{T as Te}from"./trash-2-Co2tl0ej.js";import{T}from"./trending-up-BBYh76Q9.js";import{T as A}from"./trending-down-7vN5W4-d.js";import"./chevron-up-DrbdFayN.js";import"./countries-BGn44Cmt.js";function Ue(){const{user:o,profile:F}=pe(),{toast:x}=ye(),[$,N]=d.useState(!1),[a,se]=d.useState(null),[P,te]=d.useState([]),[v,ae]=d.useState(K().month),[b,ne]=d.useState(K().year),[V,re]=d.useState({budgeted_income:"",budgeted_expenses:""}),[O,D]=d.useState({}),[I,L]=d.useState({salaries:"",allowances:"",family_income:"",others:""}),[ce,C]=d.useState(!1),[u,p]=d.useState({name:"",icon:"ðŸ“",color:"#6B7280"}),[U,Y]=d.useState(null),r=(F==null?void 0:F.default_currency)||"INR";d.useEffect(()=>{o&&(k(),H())},[o,v,b]);const k=async()=>{if(o)try{const s=await M.getCategories(o.id);te(s)}catch(s){console.error("Error loading categories:",s)}},H=async()=>{if(o){N(!0);try{const s=await R.getBudgetAnalysis(o.id,v,b);if(se(s),s!=null&&s.budget){re({budgeted_income:s.budget.budgeted_income.toString(),budgeted_expenses:s.budget.budgeted_expenses.toString()});const t={};Object.entries(s.budget.category_budgets||{}).forEach(([i,l])=>{t[i]=l.toString()}),D(t);const n={salaries:"",allowances:"",family_income:"",others:""};Object.entries(s.budget.income_category_budgets||{}).forEach(([i,l])=>{i in n&&(n[i]=l.toString())}),L(n)}}catch(s){console.error("Error loading budget analysis:",s)}finally{N(!1)}}},le=async s=>{if(s.preventDefault(),!!o){N(!0);try{const t={};Object.entries(O).forEach(([m,g])=>{const h=parseFloat(g);!isNaN(h)&&h>0&&(t[m]=h)});const n={};Object.entries(I).forEach(([m,g])=>{const h=parseFloat(g);!isNaN(h)&&h>0&&(n[m]=h)});const i=Object.values(t).reduce((m,g)=>m+g,0),l=Object.values(n).reduce((m,g)=>m+g,0);await R.createOrUpdateBudget({user_id:o.id,month:v,year:b,budgeted_income:l||parseFloat(V.budgeted_income)||0,budgeted_expenses:i||parseFloat(V.budgeted_expenses)||0,category_budgets:t,income_category_budgets:n,currency:r}),x({title:"Success",description:"Budget saved successfully"}),H()}catch(t){console.error("Error saving budget:",t),x({title:"Error",description:t.message||"Failed to save budget",variant:"destructive"})}finally{N(!1)}}},ie=(s,t)=>{D(n=>({...n,[s]:t}))},de=(s,t)=>{L(n=>({...n,[s]:t}))},oe=()=>Object.values(O).reduce((s,t)=>{const n=parseFloat(t);return s+(isNaN(n)?0:n)},0),me=()=>Object.values(I).reduce((s,t)=>{const n=parseFloat(t);return s+(isNaN(n)?0:n)},0),ue=async()=>{if(!o||!u.name.trim()){x({title:"Error",description:"Please enter a category name",variant:"destructive"});return}try{await M.createCategory({user_id:o.id,name:u.name.trim(),icon:u.icon,color:u.color,is_system:!1}),x({title:"Success",description:"Category created successfully"}),C(!1),p({name:"",icon:"ðŸ“",color:"#6B7280"}),k()}catch(s){console.error("Error creating category:",s),x({title:"Error",description:s.message||"Failed to create category",variant:"destructive"})}},xe=async s=>{if(o)try{Y(s),await M.deleteCategory(s),x({title:"Success",description:"Category deleted successfully"}),D(t=>{const n={...t};return delete n[s],n}),k()}catch(t){console.error("Error deleting category:",t),x({title:"Error",description:t.message||"Failed to delete category",variant:"destructive"})}finally{Y(null)}},ge=["ðŸ“","ðŸ’°","ðŸ ","ðŸš—","ðŸ”","ðŸŽ¬","ðŸ¥","ðŸ’¡","ðŸ“š","âœˆï¸","ðŸ›ï¸","ðŸ“±","âš¡","ðŸŽ¯","ðŸ’³","ðŸŽ"],he=Array.from({length:5},(s,t)=>new Date().getFullYear()-2+t),je=Array.from({length:12},(s,t)=>t+1);return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Budget Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Plan and track your monthly budget by category"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(J,{value:v.toString(),onValueChange:s=>ae(parseInt(s)),children:[e.jsx(Q,{className:"w-[180px]",children:e.jsx(W,{})}),e.jsx(X,{children:je.map(s=>e.jsx(Z,{value:s.toString(),children:Se(s)},s))})]}),e.jsxs(J,{value:b.toString(),onValueChange:s=>ne(parseInt(s)),children:[e.jsx(Q,{className:"w-[180px]",children:e.jsx(W,{})}),e.jsx(X,{children:he.map(s=>e.jsx(Z,{value:s.toString(),children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(B,{children:"Set Budget"})}),e.jsx(S,{children:e.jsxs("form",{onSubmit:le,className:"space-y-6",children:[e.jsxs(fe,{defaultValue:"income",className:"w-full",children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2",children:[e.jsx(z,{value:"income",children:"Income Budget"}),e.jsx(z,{value:"expenses",children:"Expense Budget"})]}),e.jsxs(G,{value:"income",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(j,{children:"Income Categories"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Total: ",c(me(),r)]})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2",children:ee.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("div",{className:"flex-1",children:e.jsx(j,{htmlFor:`income-${s.key}`,className:"text-sm",children:s.name})}),e.jsx(y,{id:`income-${s.key}`,type:"number",step:"0.01",min:"0",value:I[s.key]||"",onChange:t=>de(s.key,t.target.value),placeholder:"0.00",className:"w-32"})]},s.key))})]}),e.jsxs(G,{value:"expenses",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(j,{children:"Expense Categories"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Total: ",c(oe(),r)]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>C(!0),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Add Category"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2",children:P.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("div",{className:"flex-1",children:e.jsxs(j,{htmlFor:`category-${s.id}`,className:"text-sm",children:[s.name,!s.is_system&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Custom)"})]})}),e.jsx(y,{id:`category-${s.id}`,type:"number",step:"0.01",min:"0",value:O[s.id]||"",onChange:t=>ie(s.id,t.target.value),placeholder:"0.00",className:"w-32"}),!s.is_system&&e.jsx(f,{type:"button",variant:"ghost",size:"icon",onClick:()=>xe(s.id),disabled:U===s.id,children:U===s.id?e.jsx(q,{className:"h-4 w-4 animate-spin"}):e.jsx(Te,{className:"h-4 w-4 text-destructive"})})]},s.id))})]})]}),e.jsxs(f,{type:"submit",disabled:$,className:"w-full",children:[$&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Budget"]})]})})]}),a&&e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(B,{children:"Budget vs Actual"})}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Income"}),e.jsxs("span",{className:`text-sm font-semibold ${a.income_variance>=0?"text-success":"text-danger"}`,children:[a.income_variance>=0?e.jsx(T,{className:"inline h-4 w-4"}):e.jsx(A,{className:"inline h-4 w-4"}),c(Math.abs(a.income_variance),r)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Budgeted: ",c(a.budget.budgeted_income,r)]}),e.jsxs("span",{children:["Actual: ",c(a.actual_income,r)]})]}),e.jsx(E,{value:a.budget.budgeted_income>0?a.actual_income/a.budget.budgeted_income*100:0,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Expenses"}),e.jsxs("span",{className:`text-sm font-semibold ${a.expense_variance>=0?"text-success":"text-danger"}`,children:[a.expense_variance>=0?e.jsx(T,{className:"inline h-4 w-4"}):e.jsx(A,{className:"inline h-4 w-4"}),c(Math.abs(a.expense_variance),r)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Budgeted: ",c(a.budget.budgeted_expenses,r)]}),e.jsxs("span",{children:["Actual: ",c(a.actual_expenses,r)]})]}),e.jsx(E,{value:a.budget.budgeted_expenses>0?a.actual_expenses/a.budget.budgeted_expenses*100:0,className:"h-2"})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Net Position"}),e.jsx("span",{className:`font-bold ${a.actual_income-a.actual_expenses>=0?"text-success":"text-danger"}`,children:c(a.actual_income-a.actual_expenses,r)})]})})]})]})]}),a&&a.income_category_analysis&&Object.keys(a.income_category_analysis).filter(s=>a.income_category_analysis[s].budgeted>0).length>0&&e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(B,{children:"Income Category Analysis"})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(a.income_category_analysis).map(([s,t])=>{const n=ee.find(m=>m.key===s);if(!n||t.budgeted===0)return null;const i=t.budgeted>0?t.actual/t.budgeted*100:0,l=t.variance<0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:n.icon}),e.jsx("span",{className:"font-medium",children:n.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-semibold ${l?"text-danger":"text-success"}`,children:[l?e.jsx(A,{className:"inline h-3 w-3"}):e.jsx(T,{className:"inline h-3 w-3"}),c(Math.abs(t.variance),r)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.toFixed(0),"% achieved"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Budgeted: ",c(t.budgeted,r)]}),e.jsxs("span",{children:["Actual: ",c(t.actual,r)]})]}),e.jsx(E,{value:Math.min(i,100),className:`h-2 ${l?"[&>div]:bg-danger":""}`})]},s)})})})]}),a&&Object.keys(a.category_analysis).length>0&&e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(B,{children:"Expense Category Analysis"})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(a.category_analysis).map(([s,t])=>{const n=P.find(m=>m.id===s);if(!n)return null;const i=t.budgeted>0?t.actual/t.budgeted*100:0,l=t.variance<0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:n.icon}),e.jsx("span",{className:"font-medium",children:n.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-semibold ${l?"text-danger":"text-success"}`,children:[l?e.jsx(A,{className:"inline h-3 w-3"}):e.jsx(T,{className:"inline h-3 w-3"}),c(Math.abs(t.variance),r)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.toFixed(0),"% used"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Budgeted: ",c(t.budgeted,r)]}),e.jsxs("span",{children:["Actual: ",c(t.actual,r)]})]}),e.jsx(E,{value:Math.min(i,100),className:`h-2 ${l?"[&>div]:bg-danger":""}`})]},s)})})})]}),e.jsx(ve,{open:ce,onOpenChange:C,children:e.jsxs(be,{children:[e.jsxs(Ce,{children:[e.jsx(_e,{children:"Add Custom Category"}),e.jsx(we,{children:"Create a new expense category for your budget tracking"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"category-name",children:"Category Name *"}),e.jsx(y,{id:"category-name",value:u.name,onChange:s=>p(t=>({...t,name:s.target.value})),placeholder:"e.g., Gym Membership"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Icon"}),e.jsx("div",{className:"grid grid-cols-8 gap-2",children:ge.map(s=>e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,icon:s})),className:`text-2xl p-2 rounded hover:bg-muted transition-colors ${u.icon===s?"bg-primary/10 ring-2 ring-primary":""}`,children:s},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"category-color",children:"Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{id:"category-color",type:"color",value:u.color,onChange:s=>p(t=>({...t,color:s.target.value})),className:"w-20 h-10"}),e.jsx(y,{type:"text",value:u.color,onChange:s=>p(t=>({...t,color:s.target.value})),placeholder:"#6B7280",className:"flex-1"})]})]})]}),e.jsxs(Be,{children:[e.jsx(f,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(f,{onClick:ue,disabled:!u.name.trim(),children:"Create Category"})]})]})})]})}export{Ue as default};
