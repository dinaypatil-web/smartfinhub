import{x as ue,r as w,k as pe,t as fe,d as ye,_ as ge,j as e,A as Ne,C as l,e as m,f as h,h as i,L as S,I as q,T as ve,p as _e,q as O,s as P,B as Ce}from"./index-CadMXyJB.js";import{S as k,a as R,b as F,c as L,d as y}from"./select-BtuBbjBO.js";import{T as V,a as $,b as T,c as r,d as H,e as c}from"./table-BT0d-UrM.js";import{B as X}from"./badge-i6nMjZC_.js";import{f as j,a as I}from"./format-RllGV7dv.js";import{g as we,c as be}from"./billingCycleCalculations-BxPZ0iWz.js";import{I as De}from"./incomeCategories-h_Agwvah.js";import{C as Z,B as Te}from"./BankLogo-j26DLqyT.js";import{T as Se}from"./trending-up-BBYh76Q9.js";import{T as Ie}from"./trending-down-7vN5W4-d.js";import{D as Ae}from"./download-CITfR4fP.js";import{C as Ee}from"./credit-card-CLQXqH6e.js";import"./chevron-up-DrbdFayN.js";import"./countries-BGn44Cmt.js";function qe(){var Q;const{user:E,profile:U}=ue(),[ee,G]=w.useState(!1),[J,se]=w.useState([]),[_,te]=w.useState([]),[ae,ne]=w.useState([]),[n,M]=w.useState({startDate:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],accountId:"all",transactionType:"all",expenseCategory:"all",incomeCategory:"all"}),[u,K]=w.useState(""),[z,ce]=w.useState(`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`),[re,le]=w.useState([]),p=(U==null?void 0:U.default_currency)||"INR";w.useEffect(()=>{E&&de()},[E]),w.useEffect(()=>{const s=_.filter(a=>a.account_type==="credit_card");s.length>0&&!u&&K(s[0].id)},[_]),w.useEffect(()=>{u&&ie()},[u]);const ie=async()=>{if(u)try{const s=await pe.getEMIsByAccount(u);le(s)}catch(s){console.error("Error loading EMIs:",s)}},de=async()=>{if(E){G(!0);try{const[s,a,g]=await Promise.all([fe.getTransactions(E.id),ye.getAccounts(E.id),ge.getCategories(E.id)]);se(s),te(a),ne(g)}catch(s){console.error("Error loading data:",s)}finally{G(!1)}}},W=()=>J.filter(s=>{const a=new Date(s.transaction_date),g=new Date(n.startDate),N=new Date(n.endDate);N.setHours(23,59,59,999);const D=a>=g&&a<=N,f=n.accountId==="all"||s.from_account_id===n.accountId||s.to_account_id===n.accountId,C=n.transactionType==="all"||s.transaction_type===n.transactionType,o=n.expenseCategory==="all"||s.transaction_type==="expense"&&s.category===n.expenseCategory,t=n.incomeCategory==="all"||s.transaction_type==="income"&&s.income_category===n.incomeCategory;return D&&f&&C&&(n.expenseCategory==="all"||o)&&(n.incomeCategory==="all"||t)}),oe=()=>{const s=W(),a=t=>typeof t=="number"?t:typeof t=="string"&&parseFloat(t)||0,g=s.filter(t=>t.transaction_type==="income").reduce((t,x)=>t+a(x.amount),0),N=s.filter(t=>t.transaction_type==="expense").reduce((t,x)=>t+a(x.amount),0),D=s.filter(t=>t.transaction_type==="withdrawal").reduce((t,x)=>t+a(x.amount),0),f=s.filter(t=>t.transaction_type==="transfer").reduce((t,x)=>t+a(x.amount),0),C=s.filter(t=>t.transaction_type==="loan_payment").reduce((t,x)=>t+a(x.amount),0),o=s.filter(t=>t.transaction_type==="credit_card_repayment").reduce((t,x)=>t+a(x.amount),0);return{income:g,expenses:N,withdrawals:D,transfers:f,loanPayments:C,creditCardRepayments:o,netPosition:g-N-C,totalTransactions:s.length}},xe=()=>_.map(s=>({...s,balance:s.balance})),me=()=>{const s=W(),a=["Date","Type","Category","From Account","To Account","Amount","Description"],g=s.map(o=>{var t,x;return[I(o.transaction_date),o.transaction_type,o.category||"",((t=_.find(v=>v.id===o.from_account_id))==null?void 0:t.account_name)||"",((x=_.find(v=>v.id===o.to_account_id))==null?void 0:x.account_name)||"",o.amount.toString(),o.description||""]}),N=[a.join(","),...g.map(o=>o.map(t=>`"${t}"`).join(","))].join(`
`),D=new Blob([N],{type:"text/csv"}),f=window.URL.createObjectURL(D),C=document.createElement("a");C.href=f,C.download=`transactions_${n.startDate}_to_${n.endDate}.csv`,C.click(),window.URL.revokeObjectURL(f)},d=(()=>{if(!u||!z)return null;const s=_.find(v=>v.id===u);if(!s||!s.statement_day)return null;const[a,g]=z.split("-").map(Number),N=we(s.statement_day,s.due_day||s.statement_day),D=new Date(a,g-1,s.statement_day),f=new Date(D);f.setMonth(f.getMonth()-1),f.setDate(f.getDate()+1);const C=D,o=J.filter(v=>{const A=new Date(v.transaction_date),he=A>=f&&A<=C,je=v.from_account_id===u||v.to_account_id===u;return he&&je}),t=re.filter(v=>{const A=new Date(v.next_due_date);return A>=f&&A<=C}),x=be(u,o,t,s.statement_day);return{account:s,cycleStart:f,cycleEnd:C,statementDate:D,dueDate:new Date(N.dueDateStr),transactions:o.sort((v,A)=>new Date(A.transaction_date).getTime()-new Date(v.transaction_date).getTime()),emis:t,dueAmount:x}})(),b=oe(),Y=W(),B=xe();return ee?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ne,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"View and analyze your financial data"})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{children:"Filters"})}),e.jsxs(i,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"startDate",children:"Start Date"}),e.jsx(q,{id:"startDate",type:"date",value:n.startDate,onChange:s=>M({...n,startDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"endDate",children:"End Date"}),e.jsx(q,{id:"endDate",type:"date",value:n.endDate,onChange:s=>M({...n,endDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"accountId",children:"Account"}),e.jsxs(k,{value:n.accountId,onValueChange:s=>M({...n,accountId:s}),children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(L,{children:[e.jsx(y,{value:"all",children:"All Accounts"}),_.map(s=>e.jsx(y,{value:s.id,children:s.account_name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"transactionType",children:"Transaction Type"}),e.jsxs(k,{value:n.transactionType,onValueChange:s=>M({...n,transactionType:s}),children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(L,{children:[e.jsx(y,{value:"all",children:"All Types"}),e.jsx(y,{value:"income",children:"Income"}),e.jsx(y,{value:"expense",children:"Expense"}),e.jsx(y,{value:"withdrawal",children:"Withdrawal"}),e.jsx(y,{value:"transfer",children:"Transfer"}),e.jsx(y,{value:"loan_payment",children:"Loan Payment"}),e.jsx(y,{value:"credit_card_repayment",children:"Credit Card Repayment"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"expenseCategory",children:"Expense Category"}),e.jsxs(k,{value:n.expenseCategory,onValueChange:s=>M({...n,expenseCategory:s}),children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(L,{children:[e.jsx(y,{value:"all",children:"All Expense Categories"}),ae.map(s=>e.jsxs(y,{value:s.name,children:[s.icon," ",s.name]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"incomeCategory",children:"Income Category"}),e.jsxs(k,{value:n.incomeCategory,onValueChange:s=>M({...n,incomeCategory:s}),children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(L,{children:[e.jsx(y,{value:"all",children:"All Income Categories"}),De.map(s=>e.jsxs(y,{value:s.key,children:[s.icon," ",s.name]},s.key))]})]})]})]})]})]}),e.jsxs(ve,{defaultValue:"summary",className:"space-y-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_e,{className:"inline-flex w-full min-w-max xl:grid xl:grid-cols-4",children:[e.jsx(O,{value:"summary",className:"flex-1 xl:flex-none whitespace-nowrap",children:"Summary"}),e.jsx(O,{value:"transactions",className:"flex-1 xl:flex-none whitespace-nowrap",children:"Transaction History"}),e.jsx(O,{value:"balances",className:"flex-1 xl:flex-none whitespace-nowrap",children:"Account Balances"}),e.jsx(O,{value:"credit-card",className:"flex-1 xl:flex-none whitespace-nowrap",children:"Credit Card Statement"})]})}),e.jsxs(P,{value:"summary",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Income"}),e.jsx(Se,{className:"h-4 w-4 text-success"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold text-success",children:j(b.income,p)})})]}),e.jsxs(l,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Expenses"}),e.jsx(Ie,{className:"h-4 w-4 text-danger"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold text-danger",children:j(b.expenses,p)})})]}),e.jsxs(l,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Net Position"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:`text-2xl font-bold ${b.netPosition>=0?"text-success":"text-danger"}`,children:j(b.netPosition,p)})})]}),e.jsxs(l,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Transactions"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.totalTransactions})})]})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{children:"Transaction Breakdown"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Withdrawals"}),e.jsx("span",{className:"text-sm font-semibold",children:j(b.withdrawals,p)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Transfers"}),e.jsx("span",{className:"text-sm font-semibold",children:j(b.transfers,p)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Loan Payments"}),e.jsx("span",{className:"text-sm font-semibold",children:j(b.loanPayments,p)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Credit Card Repayments"}),e.jsx("span",{className:"text-sm font-semibold",children:j(b.creditCardRepayments,p)})]})]})})]})]}),e.jsxs(P,{value:"transactions",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ce,{onClick:me,variant:"outline",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Export to CSV"]})}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsxs(h,{children:["Transaction History (",Y.length," transactions)"]})}),e.jsx(i,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Category"}),e.jsx(r,{children:"From Account"}),e.jsx(r,{children:"To Account"}),e.jsx(r,{className:"text-right",children:"Amount"}),e.jsx(r,{children:"Description"})]})}),e.jsx(H,{children:Y.length===0?e.jsx(T,{children:e.jsx(c,{colSpan:7,className:"text-center text-muted-foreground",children:"No transactions found for the selected filters"})}):Y.map(s=>{var a,g;return e.jsxs(T,{children:[e.jsx(c,{children:I(s.transaction_date)}),e.jsx(c,{className:"capitalize",children:s.transaction_type.replace("_"," ")}),e.jsx(c,{children:s.category||"-"}),e.jsx(c,{children:((a=_.find(N=>N.id===s.from_account_id))==null?void 0:a.account_name)||"-"}),e.jsx(c,{children:((g=_.find(N=>N.id===s.to_account_id))==null?void 0:g.account_name)||"-"}),e.jsx(c,{className:"text-right font-medium",children:j(s.amount,p)}),e.jsx(c,{className:"max-w-xs truncate",children:s.description||"-"})]},s.id)})})]})})})]})]}),e.jsxs(P,{value:"balances",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{children:"Current Account Balances"})}),e.jsx(i,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Account Name"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Institution"}),e.jsx(r,{children:"Currency"}),e.jsx(r,{className:"text-right",children:"Balance"})]})}),e.jsx(H,{children:B.map(s=>e.jsxs(T,{children:[e.jsx(c,{className:"font-medium",children:s.account_name}),e.jsx(c,{className:"capitalize",children:s.account_type.replace("_"," ")}),e.jsx(c,{children:s.institution_name||"-"}),e.jsx(c,{children:s.currency}),e.jsxs(c,{className:`text-right font-semibold ${s.account_type==="credit_card"||s.account_type==="loan"?"text-danger":s.balance>=0?"text-success":"text-danger"}`,children:[j(Math.abs(s.balance),s.currency),(s.account_type==="credit_card"||s.account_type==="loan")&&" (Outstanding)"]})]},s.id))})]})})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-sm font-medium",children:"Total Assets"})}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold text-success",children:j(B.filter(s=>s.account_type==="cash"||s.account_type==="bank").reduce((s,a)=>s+a.balance,0),p)})})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-sm font-medium",children:"Total Liabilities"})}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold text-danger",children:j(B.filter(s=>s.account_type==="credit_card").reduce((s,a)=>s+Math.abs(a.balance),0),p)})})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-sm font-medium",children:"Net Worth"})}),e.jsx(i,{children:e.jsx("div",{className:`text-2xl font-bold ${B.reduce((s,a)=>a.account_type==="loan"?s:s+a.balance,0)>=0?"text-success":"text-danger"}`,children:j(B.reduce((s,a)=>a.account_type==="loan"?s:s+a.balance,0),p)})})]})]})]}),e.jsx(P,{value:"credit-card",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(m,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Credit Card Statement"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Select Credit Card"}),e.jsxs(k,{value:u,onValueChange:K,children:[e.jsx(R,{children:e.jsx(F,{placeholder:"Select a credit card"})}),e.jsx(L,{children:_.filter(s=>s.account_type==="credit_card").map(s=>e.jsx(y,{value:s.id,children:s.account_name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Select Month"}),e.jsx(q,{type:"month",value:z,onChange:s=>ce(s.target.value)})]})]}),d&&e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(l,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Statement Date"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:I(d.statementDate.toISOString())})]})}),e.jsx(l,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Due Date"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:I(d.dueDate.toISOString())})]})}),e.jsx(l,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Due Amount"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:j(d.dueAmount,p)})]})})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:"Account Information"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-md border-2 border-purple-200 dark:border-purple-800",children:e.jsx(Te,{src:d.account.institution_logo,alt:d.account.institution_name||"Credit Card",bankName:d.account.institution_name||void 0,className:"h-10 w-10"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:d.account.account_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:d.account.institution_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Current Balance"}),e.jsx("div",{className:"font-semibold text-purple-600 dark:text-purple-400",children:j(Number(d.account.balance),p)})]})]})})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:"Billing Cycle"})}),e.jsx(i,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:I(d.cycleStart.toISOString())})," to ",e.jsx("span",{className:"font-medium",children:I(d.cycleEnd.toISOString())})]})})]}),e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:"Transactions"})}),e.jsx(i,{children:d.transactions.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No transactions in this billing cycle"}):e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Category"}),e.jsx(r,{className:"text-right",children:"Amount"})]})}),e.jsx(H,{children:d.transactions.map(s=>e.jsxs(T,{children:[e.jsx(c,{className:"whitespace-nowrap",children:I(s.transaction_date)}),e.jsx(c,{children:s.description||"-"}),e.jsx(c,{children:e.jsx(X,{variant:"outline",children:s.category||"Uncategorized"})}),e.jsx(c,{className:"text-right font-medium",children:e.jsxs("span",{className:s.from_account_id===u?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",children:[s.from_account_id===u?"-":"+",j(s.amount,p)]})})]},s.id))})]})})]}),d.emis.length>0&&e.jsxs(l,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:"EMI Transactions"})}),e.jsx(i,{children:e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Next Due Date"}),e.jsx(r,{children:"Description"}),e.jsx(r,{className:"text-right",children:"Monthly EMI"}),e.jsx(r,{className:"text-right",children:"Remaining"})]})}),e.jsx(H,{children:d.emis.map(s=>e.jsxs(T,{children:[e.jsx(c,{className:"whitespace-nowrap",children:I(s.next_due_date)}),e.jsx(c,{children:s.description||"EMI Payment"}),e.jsx(c,{className:"text-right font-medium text-red-600 dark:text-red-400",children:j(s.monthly_emi,p)}),e.jsx(c,{className:"text-right",children:e.jsxs(X,{variant:"secondary",children:[s.remaining_installments," / ",s.emi_months]})})]},s.id))})]})})]})]}),!d&&u&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:(Q=_.find(s=>s.id===u))!=null&&Q.statement_day?"Select a month to view the statement":"This credit card does not have a statement day configured"}),_.filter(s=>s.account_type==="credit_card").length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No credit cards found. Add a credit card account to view statements."})]})]})})]})]})}export{qe as default};
